/*! Minislate - v0.3.0 - 2016-09-30T15:09:00Z - Olivier Meunier and contributors. */

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Minislate=e()}}(function(){return function e(f,n,o){function d(t,l){if(!n[t]){if(!f[t]){var u="function"==typeof require&&require;if(!l&&u)return u(t,!0);if(i)return i(t,!0);throw new Error("Cannot find module '"+t+"'")}var p=n[t]={exports:{}};f[t][0].call(p.exports,function(e){var n=f[t][1][e];return d(n?n:e)},p,p.exports,e,f,n,o)}return n[t].exports}for(var i="function"==typeof require&&require,t=0;t<o.length;t++)d(o[t]);return d}({1:[function(e,f,n){var o=e("./util"),d=o.Class,i=o.extend,t=d(Object,{init:function(){this.controls={}},addControl:function(e,f,n){throw new Error("Not implemented")},removeControl:function(e){this.controls[e]&&delete this.controls[e]}}),l=d(Object,{defaults:{label:null,title:"",classes:"",fontAwesomeID:null},classes:[],init:function(e,f,n){this.options=i({},this.defaults,n||{}),this.toolbar=e,this.id=f,this.label=this.options.label||this.id,this.element=this._initElement(),this.setLabel(),this.element.setAttribute("title",this.options.title),this.options.classes&&this.classes.push.apply(this.classes,this.options.classes.split(/\s+/));for(var o=0;o<this.classes.length;o++)this.element.classList.add(this.toolbar._getClassName(this.classes[o]));var d=this;this.toolbar.element.addEventListener("toolbar.show",function(){d.setVisibility(),d.setHighlight()})},_initElement:function(){throw new Error("_initElement not implemented")},drawElement:function(e){return e=e||document.createElement("li"),e.appendChild(this.element),e},setLabel:function(e,f){for(e=e||this.label,f=f||this.options.fontAwesomeID;this.element.firstChild;)this.element.removeChild(this.element.firstChild);var n=document.createTextNode(e),o=document.createElement("span");if(o.appendChild(n),this.toolbar.options.fontAwesomeEnabled&&f){var d=this.getFaElement(f);d.appendChild(o),this.element.appendChild(d)}else this.element.appendChild(o)},isHighlighted:function(){return!1},isVisible:function(){return!0},setVisibility:function(e){e="undefined"!=typeof e?e:this.isVisible(),e?this.element.parentNode.style.display="block":this.element.parentNode.style.display="none"},setHighlight:function(e){e="undefined"!=typeof e?e:this.isHighlighted();var f=this.toolbar._getClassName("highlight");e?this.element.classList.contains(f)||this.element.classList.add(f):this.element.classList.remove(f)},getFaElement:function(e){var f=document.createElement("i");return f.classList.add("fa","fa-"+e),f}}),u=d(l,{classes:["button"],init:function(e,f,n){l.prototype.init.call(this,e,f,n);var o=this;this.element.addEventListener("click",function(e){o.click(e)})},_getParentElement:function(){var e=l.prototype._getParentElement.call(this);return e.classList.add(this.toolbar._getClassName("button")),e},_initElement:function(){return document.createElement("button")},drawElement:function(){var e=document.createElement("li");return e.classList.add(this.toolbar._getClassName("button")),l.prototype.drawElement.call(this,e)},click:function(){}}),p=d(l,{defaults:i({},l.prototype.defaults,{controls:[]}),classes:["button"],closeDelay:400,init:function(e,f,n){t.prototype.init.call(this),l.prototype.init.call(this,e,f,n);for(var o,d,i,u=0;u<this.options.controls.length;u++)o=this.options.controls[u][0],d=this.options.controls[u][1],i=this.options.controls[u][2],this.addControl(o,d,i);this.container=document.createElement("ul"),this.container.classList.add(this.toolbar._getClassName("controls")),this.container.style.display="none";var p=this,s=function(){p._open()},y=function(){p._closetimer()},a=function(){p._canceltimer()};this.toolbar.element.addEventListener("toolbar.show",function(){p._close(),p.element.removeEventListener("mouseover",s),p.element.removeEventListener("mouseout",y),p.container.removeEventListener("mouseover",a),p.container.removeEventListener("mouseout",y),setTimeout(function(){p.element.addEventListener("mouseover",s),p.element.addEventListener("mouseout",y),p.container.addEventListener("mouseover",a),p.container.addEventListener("mouseout",y)},200)})},_open:function(){var e,f;for(f in this.toolbar.controls)e=this.toolbar.controls[f],e instanceof p&&(e._canceltimer(),e._close());this._canceltimer(),this.container.style.display="block"},_close:function(){this.container.style.display="none"},_closetimer:function(){var e=this;this.closeTimeout=setTimeout(function(){e._close()},this.closeDelay)},_canceltimer:function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},_initElement:function(){return document.createElement("button")},isHighlighted:function(){var e,f;for(f in this.controls)if(e=this.controls[f],e.id,e.isHighlighted())return this.setLabel(e.label,e.options.fontAwesomeID),!0;return!1},drawElement:function(){var e=document.createElement("li");return e.classList.add(this.toolbar._getClassName("menu")),e=l.prototype.drawElement.call(this,e),e.appendChild(this.container),this.drawControls(),e},setLabel:function(e,f){l.prototype.setLabel.call(this,e,f),this.element.appendChild(document.createTextNode(" "));var n;this.toolbar.options.fontAwesomeEnabled?n=this.getFaElement("chevron-down"):(n=document.createElement("span"),n.classList.add(this.toolbar._getClassName("menu-arrow")),n.appendChild(document.createTextNode("↓"))),this.element.appendChild(n)},addControl:function(e,f,n){this.controls[f]=new e(this.toolbar,f,n),this.toolbar._dirty=!0},removeControl:function(e){this.controls[e]&&(t.prototype.removeControl.call(this,e),this.toolbar._dirty=!0)},drawControls:function(){for(var e,f,n;this.container.firstChild;)this.container.removeChild(this.container.firstChild);for(f in this.controls)if(e=this.controls[f],n=e.drawElement(),e.setLabel(),this.container.appendChild(n),e.options.title){var o=document.createElement("em"),d=document.createTextNode(" - "+e.options.title);o.appendChild(d),n.firstChild.appendChild(o)}}}),s=d(Object,{init:function(e){this.control=e,this.toolbar=e.toolbar,this.element=e.toolbar.dialog},addTextField:function(e,f){var n={size:30,enter:null,escape:null};f=i({},n,f||{});var o=document.createElement("input"),d=document.createElement("label");return d.appendChild(document.createTextNode(e)),o.setAttribute("size",f.size),o.setAttribute("type","text"),d.appendChild(o),this.element.appendChild(d),(f.enter||f.escape)&&o.addEventListener("keyup",function(e){f.escape&&27===e.which?f.escape.call(o,e):f.enter&&13===e.which&&f.enter.call(o,e)}),o},addButton:function(e,f){var n={click:null,fontAwesomeID:null};f=i({},n,f||{});var o=document.createElement("button");if(o.appendChild(document.createTextNode(e)),this.element.appendChild(document.createTextNode(" ")),this.element.appendChild(o),this.element.appendChild(document.createTextNode(" ")),f.click&&"function"==typeof f.click&&o.addEventListener("click",f.click),f.fontAwesomeID&&this.toolbar.options.fontAwesomeEnabled){o.removeChild(o.firstChild),o.setAttribute("title",e);var d=l.prototype.getFaElement.call(null,f.fontAwesomeID);o.appendChild(d)}return o}});n.ControlsMixin=t,n.BaseControl=l,n.Button=u,n.Menu=p,n.Dialog=s},{"./util":9}],2:[function(e,f,n){var o=e("../util"),d=e("../controls"),i=e("../../vendor/rangy/core").api,t=o.Class,l=o.extend,u=o._,p=o.tr,s=d.Button,y=t(s,{tagList:[],tag:null,command:"formatblock",defaults:l({},s.prototype.defaults),init:function(){s.prototype.init.apply(this,arguments),this.BLOCK_NODES=u.filter(this.toolbar.editor.BLOCK_NODES,function(e){return-1===["ul","ol"].indexOf(e.toLowerCase())})},isHighlighted:function(){return this.toolbar.editor.filterTopNodeNames.apply(this.toolbar.editor,this.tagList).length>0},click:function(){var e,f=this.toolbar.editor;"formatblock"===this.command?(this.isHighlighted()||(e=f.filterTopNodeNames.apply(f,this.BLOCK_NODES),e.length>0&&f.setRange(e[0])),this.toolbar.editor.exec(this.command,"<"+this.tag+">")):this.toolbar.editor.exec(this.command),this.toolbar.editor.showToolbar()}});n.Block=y,n.Paragraph=t(y,{tagList:["p"],tag:"p",command:"formatblock",defaults:l({},y.prototype.defaults,{label:"¶",title:p("Paragraph")})});for(var a=1;6>=a;a++){var c=t(y,{tagList:["h"+a],tag:"h"+a,defaults:l({},y.prototype.defaults,{label:"H"+a,title:p("Title level {level}",{level:a})})});n["H"+a]=c}n.Preformated=t(y,{tagList:["pre"],tag:"pre",defaults:l({},y.prototype.defaults,{label:"<>",title:p("Code"),fontAwesomeID:"code",tabReplacement:"    "}),init:function(){y.prototype.init.apply(this,arguments);var e=this,f=this.toolbar.editor;f.on("keydown",function(n){9!==n.which||n.ctrlKey||n.metaKey||n.shiftKey||f.filterTopNodeNames("pre").length>0&&(n.preventDefault(),f.exec("insertHtml",e.options.tabReplacement))})},click:function(){y.prototype.click.call(this);var e=this.toolbar.editor,f=e.getEnclosingNode(),n=[].slice.call(f.getElementsByTagName("br"));u.each(n,function(e){e.parentNode.insertBefore(document.createTextNode("\n"),e),e.parentNode.removeChild(e)})}});var r=t(y,{init:function(){y.prototype.init.apply(this,arguments);var e=this,f=this.toolbar.editor;f.on("keydown",function(n){if(9===n.which&&!n.ctrlKey&&!n.metaKey){var o=f.filterTopNodeNames("ul","ol");if(0===o.length||o[0].nodeName.toLowerCase()!==e.tag)return;n.preventDefault(),n.shiftKey?f.exec("outdent"):f.exec("indent")}})},click:function(){var e=this.toolbar.editor,f=e.filterTopNodeNames("ul","ol");if(f.length>0){if(f[0].nodeName.toLowerCase()===this.tag)return;var n=f[0],o=i.saveSelection(),d=document.createElement(this.tag);n.parentNode.insertBefore(d,n),u.each([].slice.call(n.childNodes),function(e){d.appendChild(e)}),n.parentNode.removeChild(n),i.restoreSelection(o),i.removeMarkers(o),e.showToolbar()}else y.prototype.click.call(this)}});n.UnorderedList=t(r,{tagList:["ul"],tag:"ul",command:"insertunorderedlist",defaults:l({},r.prototype.defaults,{label:"UL",title:p("Unordered list"),fontAwesomeID:"list-ul"})}),n.OrderedList=t(r,{tagList:["ol"],tag:"ol",command:"insertorderedlist",defaults:l({},r.prototype.defaults,{label:"OL",title:p("Ordered list"),fontAwesomeID:"list-ol"})}),n.Blockquote=t(y,{tagList:["blockquote"],defaults:l({},y.prototype.defaults,{label:"Quote",title:p("Quote"),fontAwesomeID:"quote-right"}),init:function(){y.prototype.init.apply(this,arguments);var e=this,f=this.toolbar.editor;f.on("keyup",function(e){if(13===e.which&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey){var n=f.filterTopNodeNames("blockquote");if(0===n.length||!f.getSelection().isCollapsed)return;var o=n[0];if(n=f.filterTopNodeNames("p"),0===n.length)return;n=n[0],n.previousSibling&&""===n.previousSibling.textContent&&(n.previousSibling.parentNode.removeChild(n.previousSibling),o.parentNode.insertBefore(n,o.nextSibling),f.setRange(n),f.getSelection().collapse(n))}}),f.on("keydown",function(n){if(9===n.which&&!n.ctrlKey&&!n.metaKey){var o=f.filterTopNodeNames("blockquote");if(0===o.length)return;n.preventDefault(),n.shiftKey?e.removeBlockquote():e.insertBlockquote()}})},click:function(){var e=this.toolbar.editor,f=e.getSelection();f.isCollapsed&&0===e.getTopNodes().length||(e.filterTopNodeNames("blockquote").length>0?this.removeBlockquote():this.insertBlockquote(),e.showToolbar())},insertBlockquote:function(){var e=this.toolbar.editor,f=e.filterTopNodeNames.apply(e,e.BLOCK_NODES),n=f.length>0?f[0]:null,o=e.getSurroundingNodes(function(f){return-1!==e.BLOCK_NODES.indexOf(f.nodeName.toUpperCase())});f=o.length>0?o:n?[n]:e.getSurroundingNodes(),e.setRange(f[0],f[f.length-1]),f=e.getSurroundingNodes();var d=document.createElement("blockquote");f[0].parentNode.insertBefore(d,f[0]),u.each(f,d.appendChild,d),e.setRange(d)},removeBlockquote:function(){var e=this.toolbar.editor.filterTopNodeNames("blockquote"),f=i.saveSelection();i.dom.replaceNodeByContents(e[0]),i.restoreSelection(f),i.removeMarkers(f)}})},{"../../vendor/rangy/core":11,"../controls":1,"../util":9}],3:[function(e,f,n){var o=e("../util"),d=e("../controls"),i=e("../../vendor/rangy/core").api,t=o.Class,l=o.extend,u=o._,p=o.tr,s=d.Button,y=d.Dialog,a=t(s,{tagList:[],command:null,isHighlighted:function(){return this.toolbar.editor.filterTopNodeNames.apply(this.toolbar.editor,this.tagList).length>0},isVisible:function(){return!this.toolbar.editor.getSelection().isCollapsed||this.isHighlighted()},click:function(){var e=this.toolbar.editor;if(e.getSelection().isCollapsed){var f=e.filterTopNodeNames.apply(e,this.tagList);if(0===f.length)return;f=f[0],e.setRange(f)}e.exec(this.command),e.showToolbar()}});n.Inline=a,n.Bold=t(a,{defaults:l({},a.prototype.defaults,{label:"B",title:p("Bold"),fontAwesomeID:"bold"}),tagList:["b","strong"],command:"bold",init:function(){a.prototype.init.apply(this,arguments);var e=this,f=this.toolbar.editor;f.on("keydown",function(f){66===f.which&&(f.ctrlKey||f.metaKey)&&(f.preventDefault(),e.click())})}}),n.Italic=t(a,{defaults:l({},a.prototype.defaults,{label:"I",title:p("Italic"),fontAwesomeID:"italic"}),tagList:["i","em"],command:"italic",init:function(){a.prototype.init.apply(this,arguments);var e=this,f=this.toolbar.editor;f.on("keydown",function(f){73===f.which&&(f.ctrlKey||f.metaKey)&&(f.preventDefault(),e.click())})}}),n.Underline=t(a,{defaults:l({},a.prototype.defaults,{label:"U",title:p("Underline"),fontAwesomeID:"underline"}),tagList:["u","ins"],command:"underline"}),n.StrikeThrough=t(a,{defaults:l({},a.prototype.defaults,{label:"S",title:p("Strike-Through"),fontAwesomeID:"strikethrough"}),tagList:["strike","del"],command:"strikeThrough"});var c=t(y,{show:function(e){var f=this.control,n=this.toolbar.editor,o=i.saveSelection();n.showDialog(function(){d.focus()});var d=this.addTextField("URL: ",{escape:function(){n.restoreSelection(o)},enter:function(d){n.restoreSelection(o),f.saveLink(e,d.target.value)}});this.addButton("Save",{fontAwesomeID:"check",click:function(i){i.stopImmediatePropagation(),n.restoreSelection(o),f.saveLink(e,d.value)}}),e&&(d.value=e.getAttribute("href"),this.addButton("Remove",{fontAwesomeID:"chain-broken",click:function(d){d.stopImmediatePropagation(),n.restoreSelection(o),f.saveLink(e,null)}}))}});n.Link=t(s,{defaults:l({},s.prototype.defaults,{label:"#",base_title:p("Link"),title:"",fontAwesomeID:"link"}),init:function(){s.prototype.init.apply(this,arguments);var e=this,f=this.toolbar.editor;f.on("keydown",function(f){75===f.which&&f.shiftKey&&(f.ctrlKey||f.metaKey)&&(f.preventDefault(),e.click())})},isHighlighted:function(){var e=this.options.base_title,f=this.toolbar.editor.filterTopNodeNames("a");return f.length>0&&(e+=": "+f[0].href),this.element.setAttribute("title",e),f.length>0},isVisible:function(){return!this.toolbar.editor.getSelection().isCollapsed||this.isHighlighted()},click:function(){var e=this.toolbar.editor,f=e.getSelection().isCollapsed,n=e.filterTopNodeNames("a");f&&0===n.length||(n=0===n.length?null:n[0],f&&e.setRange(n),new c(this).show(n))},saveLink:function(e,f){var n=this.toolbar.editor,o=n.getRange();if(e)if(f)e.setAttribute("href",f),n.setRange(e);else{var d=i.saveSelection();i.dom.replaceNodeByContents(e,!0),i.restoreSelection(d),i.removeMarkers(d)}else if(f){e=document.createElement("a"),e.setAttribute("href",f);var t=o.cloneContents();u.each(t.childNodes,function(f){e.appendChild(f.cloneNode(!0))}),o.deleteContents(),o.insertNode(e),n.setRange(e)}return n.showToolbar(),e}})},{"../../vendor/rangy/core":11,"../controls":1,"../util":9}],4:[function(e,f,n){var o=e("../util"),d=e("../controls"),i=e("../../vendor/rangy/core").api,t=o.Class,l=o.extend,u=d.Button,p=o.tr,s=d.Dialog,y=t(s,{show:function(e){var f=this.control,n=this.toolbar.editor,o=i.saveSelection();n.showDialog(function(){d.focus()});var d=this.addTextField("URL: ",{escape:function(){n.restoreSelection(o)},enter:function(d){n.restoreSelection(o),f.saveImage(e,d.target.value)}});this.addButton("Save",{fontAwesomeID:"check",click:function(i){i.stopImmediatePropagation(),n.restoreSelection(o),f.saveImage(e,d.value)}}),e&&(d.value=e.getAttribute("src"))}});n.Image=t(u,{defaults:l({},u.prototype.defaults,{label:"IMG",title:p("Image"),fontAwesomeID:"picture-o"}),init:function(){u.prototype.init.apply(this,arguments);var e=this.toolbar.editor;e.on("click",function(f){"img"===f.target.tagName.toLowerCase()&&(e.setRange(f.target),e.showToolbar())})},isHighlighted:function(){return this.toolbar.editor.filterTopNodeNames("img").length>0},click:function(){var e=this.toolbar.editor,f=e.filterTopNodeNames("img");f=0===f.length?null:f[0],new y(this).show(f)},saveImage:function(e,f){var n=this.toolbar.editor,o=n.getRange();return e&&f?(e.setAttribute("src",f),n.setRange(e)):f&&(e=document.createElement("img"),e.setAttribute("src",f),o.deleteContents(),o.insertNode(e),n.cleanBlock(e.parentNode),n.setRange(e)),n.showToolbar(),e}}),n.Oembed=t(u,{defaults:l({},u.prototype.defaults,{label:"Embeded",title:p("Embeded content"),fontAwesomeID:"youtube-play"}),click:function(){window.alert("No implemented yet :)")}})},{"../../vendor/rangy/core":11,"../controls":1,"../util":9}],5:[function(e,f,n){var o=e("../vendor/rangy/core").api,d=e("./util").extend,i=e("./util").Class,t=e("./toolbar").Toolbar,l=e("./util")._,u=e("./util").tr,p=e("./html-cleaner").HtmlCleaner,s=i(Object,{defaults:{delay:300,offsetX:2,offsetY:-10,classPrefix:"editor-",fontAwesomeEnabled:!0,rtl:!1},BLOCK_NODES:"P H1 H2 H3 H4 H5 H6 UL OL PRE DL DIV NOSCRIPT BLOCKQUOTE FORM HR TABLE FIELDSET ADDRESS".split(" "),init:function(e,f){if(!window.getSelection)throw new Error("Browser features missing.");"object"==typeof e&&(this.element=e,o.initialized||o.init(),this.isActive=!0,this.isSelected=!1,this.options=d({},this.defaults,f),this.options.i18n&&u.register(this.options.i18n),this.isRtl=this.options.rtl||"rtl"===document.documentElement.getAttribute("dir"),this._currentEditor=null,this._resizeHandler=function(e){var f=null;return function(){clearTimeout(f),f=setTimeout(function(){e.setToolbarPosition()},250)}}(this),this.initElement().initToolbar().bindSelect().bindTyping())},on:function(e,f){this.element.addEventListener(e,f)},off:function(e,f){this.element.removeEventListener(e,f)},initElement:function(){var e=this;return this.element.setAttribute("contentEditable",!0),this.element.setAttribute("data-editor-element",!0),this.on("focus",function(){e._onFocus()}),this},bindSelect:function(){var e=this,f=null,n=function(n){clearTimeout(f),f=setTimeout(function(){e._onSelect(n)},e.options.delay)};return document.addEventListener("mouseup",n),document.addEventListener("keyup",n),this},bindTyping:function(){var e=this;return this.on("keyup",function(f){var n=e.getSelection();9!==f.which&&n.isCollapsed&&n.getEnclosingNode()===e._currentEditor&&e.exec("formatBlock","p")}),this},initToolbar:function(){var e=this;return this.toolbar=new t(this,{classPrefix:this.options.classPrefix,fontAwesomeEnabled:this.options.fontAwesomeEnabled}),this.toolbar.element.addEventListener("toolbar.show",function(){e.focus()}),this.toolbar.element.addEventListener("toolbar.hide",function(){var f=e.element.querySelectorAll("span.rangySelectionBoundary");l.each(f,function(e){e.parentNode.removeChild(e)})}),this},exec:function(e,f){document.execCommand(e,!1,f)},focus:function(){this._currentEditor&&this._currentEditor.focus()},showToolbar:function(){return this.toolbar.hideDialog(),this.toolbar.show(),this.setToolbarPosition(),window.addEventListener("resize",this._resizeHandler),this},hideToolbar:function(){return window.removeEventListener("resize",this._resizeHandler),this.toolbar.hide(),this},showDialog:function(e){var f=this;return this.toolbar.showDialog(),setTimeout(function(){f.setToolbarPosition(),"function"==typeof e&&e.call(f)},20),this},setToolbarPosition:function(){var e,f=this.getSelection(),n=this.getRange(),d=f.getEnclosingNode(),i=this.toolbar.element.offsetHeight,t=this.toolbar.element.offsetWidth;if(!f.isCollapsed&&o.util.isHostMethod(n.nativeRange,"getBoundingClientRect"))e=n.nativeRange.getBoundingClientRect();else{for(;1===d.parentNode.childNodes.length;)d=d.parentNode;e=d.getBoundingClientRect()}var l=0;l=e.top<i?e.bottom-this.options.offsetY+window.pageYOffset:e.top+this.options.offsetY+window.pageYOffset-i;var u=e.left-this.options.offsetX,p=e.right-t+this.options.offsetX,s=e.right-t<this._currentEditor.offsetLeft,y=this._currentEditor.offsetLeft+this._currentEditor.offsetWidth<t+e.left;(this.isRtl&&!s||y)&&(u=p),this.toolbar.move(l,u)},restoreSelection:function(e,f){f="undefined"==typeof f?!0:f,o.restoreSelection(e),o.removeMarkers(e),this.element.focus(),f&&this.showToolbar()},_onFocus:function(){this._currentEditor=this.element},_onSelect:function(e){var f=[this.element,this.toolbar.element];return o.dom.hasParents(e.target,f)?(this._currentEditor=this.element,o.dom.hasParents(e.target,[this.toolbar.element])||this.showToolbar(),void(this.isSelected||(this.isSelected=!0,9===e.which&&this.selectStart()))):void(this.isSelected&&(this.hideToolbar(),this._currentEditor=null,this.isSelected=!1))},selectStart:function(){var e=this.getSelection();if(e.isCollapsed){this.element.childNodes.length>0&&3===this.element.firstChild.nodeType&&""===this.element.firstChild.textContent.replace(/^\s*(.*?)\s*$/,"$1")&&this.element.removeChild(this.element.firstChild);var f,n;if(this.element.childNodes.length>0?(f=this.element.firstChild,n=o.dom.getNodes(f,3),n.length>0&&(f=n[0])):(f=document.createElement("p"),this.element.appendChild(f),f.appendChild(document.createTextNode("")),f=f.firstChild),3===f.nodeType){var d=o.createRange();d.setStart(f,0),this.getSelection().setSingleRange(d)}else this.setRange(f);this.showToolbar()}},getSelection:function(){return o.getSelection()},getRange:function(e){return e="undefined"==typeof e?0:e,this.getSelection().getRangeAt(0)},setRange:function(e,f){if("undefined"!=typeof e){var n=o.createRange();n.selectNodeContents(e),f&&f!==e&&(f.lastChild?n.setEndAfter(f.lastChild):n.setEndAfter(f)),this.getSelection().setSingleRange(n)}},getEnclosingNode:function(){var e=this.getSelection();if(1!==e.rangeCount)return null;var f=e.getEnclosingNode();return f===this._currentEditor?null:f},getTopNodes:function(e){var f=this.getSelection();return 1!==f.rangeCount?[]:f.getTopNodes(this._currentEditor,e)},getSurroundingNodes:function(e){var f=this.getSelection();return 1!==f.rangeCount?[]:f.getSurroundingNodes(e)},filterTopNodeNames:function(){var e=l.map(arguments,function(e){return e.toLowerCase()});return this.getTopNodes(function(f){return-1!==e.indexOf(f.nodeName.toLowerCase())})},cleanBlock:function(e){var f=e.childNodes[e.childNodes.length-1];1===f.nodeType&&"br"===f.nodeName.toLowerCase()&&e.removeChild(f)},serialize:function(e){var f=this.element.innerHTML;if(e){var n=new p;f=n.clean(f)}return f}});n.Editor=s;var y={Menu:e("./controls").Menu,Dialog:e("./controls").Dialog,Button:e("./controls").Button,inline:e("./controls/inline"),block:e("./controls/block"),media:e("./controls/media")};n.controls=y,n.simpleEditor=i(s,{init:function(){s.prototype.init.apply(this,arguments),this.toolbar.addControl(y.Menu,"blocks",{label:"¶",title:"Blocks",controls:[[y.block.Paragraph,"p"],[y.block.H1,"h1"],[y.block.H2,"h2"],[y.block.H3,"h3"],[y.block.Preformated,"pre"]]}),this.toolbar.addControl(y.Menu,"lists",{label:"Lists",title:"Lists",fontAwesomeID:"list-ul",controls:[[y.block.UnorderedList,"ul"],[y.block.OrderedList,"ol"]]}),this.toolbar.addControl(y.block.Blockquote,"quote"),this.toolbar.addControl(y.inline.Bold,"bold"),this.toolbar.addControl(y.inline.Italic,"italic"),this.toolbar.addControl(y.inline.Underline,"underline"),this.toolbar.addControl(y.inline.StrikeThrough,"strike"),this.toolbar.addControl(y.inline.Link,"link"),this.toolbar.addControl(y.media.Image,"image"),this.toolbar.addControl(y.media.Oembed,"oembed")}})},{"../vendor/rangy/core":11,"./controls":1,"./controls/block":2,"./controls/inline":3,"./controls/media":4,"./html-cleaner":6,"./toolbar":8,"./util":9}],6:[function(e,f,n){var o=e("./util").Class,d=e("./util").extend,i=e("./util")._,t=o(Object,{defaults:{},init:function(e){this.options=d({},this.defaults,e)},formatRegexp:[[/(<[a-z][^>]*)margin\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)margin-bottom\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)margin-left\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)margin-right\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)margin-top\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)padding\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)padding-bottom\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)padding-left\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)padding-right\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)padding-top\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font-family\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font-size\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font-style\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font-variant\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)font-weight\s*:[^;]*;/gm,"$1"],[/(<[a-z][^>]*)color\s*:[^;]*;/gm,"$1"]],cleanRegexp:[[/<meta[\w\W]*?>/gim,""],[/<style[\w\W]*?>[\w\W]*?<\/style>/gim,""],[/<\/?font[\w\W]*?>/gim,""],[/<(\/?)(B|b|STRONG)([\s>\/])/g,"<$1strong$3"],[/<(\/?)(I|i|EM)([\s>\/])/g,"<$1em$3"],[/<IMG ([^>]*?[^\/])>/gi,"<img $1 />"],[/<INPUT ([^>]*?[^\/])>/gi,"<input $1 />"],[/<COL ([^>]*?[^\/])>/gi,"<col $1 />"],[/<AREA ([^>]*?[^\/])>/gi,"<area $1 />"],[/<PARAM ([^>]*?[^\/])>/gi,"<param $1 />"],[/<HR ([^>]*?[^\/])>/gi,"<hr $1/>"],[/<BR ([^>]*?[^\/])>/gi,"<br $1/>"],[/<(\/?)U([\s>\/])/gi,"<$1ins$2"],[/<(\/?)STRIKE([\s>\/])/gi,"<$1del$2"],[/<span style="font-weight: normal;">([\w\W]*?)<\/span>/gm,"$1"],[/<span style="font-weight: bold;">([\w\W]*?)<\/span>/gm,"<strong>$1</strong>"],[/<span style="font-style: italic;">([\w\W]*?)<\/span>/gm,"<em>$1</em>"],[/<span style="text-decoration: underline;">([\w\W]*?)<\/span>/gm,"<ins>$1</ins>"],[/<span style="text-decoration: line-through;">([\w\W]*?)<\/span>/gm,"<del>$1</del>"],[/<span style="text-decoration: underline line-through;">([\w\W]*?)<\/span>/gm,"<del><ins>$1</ins></del>"],[/<span style="(font-weight: bold; ?|font-style: italic; ?){2}">([\w\W]*?)<\/span>/gm,"<strong><em>$2</em></strong>"],[/<span style="(font-weight: bold; ?|text-decoration: underline; ?){2}">([\w\W]*?)<\/span>/gm,"<ins><strong>$2</strong></ins>"],[/<span style="(font-weight: italic; ?|text-decoration: underline; ?){2}">([\w\W]*?)<\/span>/gm,"<ins><em>$2</em></ins>"],[/<span style="(font-weight: bold; ?|text-decoration: line-through; ?){2}">([\w\W]*?)<\/span>/gm,"<del><strong>$2</strong></del>"],[/<span style="(font-weight: italic; ?|text-decoration: line-through; ?){2}">([\w\W]*?)<\/span>/gm,"<del><em>$2</em></del>"],[/<span style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline; ?){3}">([\w\W]*?)<\/span>/gm,"<ins><strong><em>$2</em></strong></ins>"],[/<span style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: line-through; ?){3}">([\w\W]*?)<\/span>/gm,"<del><strong><em>$2</em></strong></del>"],[/<span style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline line-through; ?){3}">([\w\W]*?)<\/span>/gm,"<del><ins><strong><em>$2</em></strong></ins></del>"],[/<strong style="font-weight: normal;">([\w\W]*?)<\/strong>/gm,"$1"],[/<([a-z]+) style="font-weight: normal;">([\w\W]*?)<\/\1>/gm,"<$1>$2</$1>"],[/<([a-z]+) style="font-weight: bold;">([\w\W]*?)<\/\1>/gm,"<$1><strong>$2</strong></$1>"],[/<([a-z]+) style="font-style: italic;">([\w\W]*?)<\/\1>/gm,"<$1><em>$2</em></$1>"],[/<([a-z]+) style="text-decoration: underline;">([\w\W]*?)<\/\1>/gm,"<ins><$1>$2</$1></ins>"],[/<([a-z]+) style="text-decoration: line-through;">([\w\W]*?)<\/\1>/gm,"<del><$1>$2</$1></del>"],[/<([a-z]+) style="text-decoration: underline line-through;">([\w\W]*?)<\/\1>/gm,"<del><ins><$1>$2</$1></ins></del>"],[/<([a-z]+) style="(font-weight: bold; ?|font-style: italic; ?){2}">([\w\W]*?)<\/\1>/gm,"<$1><strong><em>$3</em></strong></$1>"],[/<([a-z]+) style="(font-weight: bold; ?|text-decoration: underline; ?){2}">([\w\W]*?)<\/\1>/gm,"<ins><$1><strong>$3</strong></$1></ins>"],[/<([a-z]+) style="(font-weight: italic; ?|text-decoration: underline; ?){2}">([\w\W]*?)<\/\1>/gm,"<ins><$1><em>$3</em></$1></ins>"],[/<([a-z]+) style="(font-weight: bold; ?|text-decoration: line-through; ?){2}">([\w\W]*?)<\/\1>/gm,"<del><$1><strong>$3</strong></$1></del>"],[/<([a-z]+) style="(font-weight: italic; ?|text-decoration: line-through; ?){2}">([\w\W]*?)<\/\1>/gm,"<del><$1><em>$3</em></$1></del>"],[/<([a-z]+) style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline; ?){3}">([\w\W]*?)<\/\1>/gm,"<ins><$1><strong><em>$3</em></strong></$1></ins>"],[/<([a-z]+) style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: line-through; ?){3}">([\w\W]*?)<\/\1>/gm,"<del><$1><strong><em>$3</em></strong></$1></del>"],[/<([a-z]+) style="(font-weight: bold; ?|font-style: italic; ?|text-decoration: underline line-through; ?){3}">([\w\W]*?)<\/\1>/gm,"<del><ins><$1><strong><em>$3</em></strong></$1></ins></del>"],[/<p><blockquote>(.*)(\n)+<\/blockquote><\/p>/i,"<blockquote>$1</blockquote>\n"],[/<\/(strong|em|ins|del|q|code)>(\s*?)<\1>/gim,"$2"],[/<(br|BR)>/g,"<br />"],[/<(hr|HR)>/g,"<hr />"],[/([^\s])\/>/g,"$1 />"],[/<br \/>\s*<\/(h1|h2|h3|h4|h5|h6|ul|ol|li|p|blockquote|div)/gi,"</$1"],[/<\/(h1|h2|h3|h4|h5|h6|ul|ol|li|p|blockquote)>([^\n\u000B\r\f])/gi,"</$1>\n$2"],[/<hr style="width: 100%; height: 2px;" \/>/g,"<hr />"],[/style="\s*?"/gim,""],[/<\s+/gim,"<"],[/\s+>/gim,">"]],removeFormat:function(e){return i.each(this.formatRegexp,function(f){e="".replace.apply(e,f)}),e},tagsoup2html:function(e){for(i.each(this.cleanRegexp,function(f){e="".replace.apply(e,f)});/(<[^\/!]>|<[^\/!][^>]*[^\/]>)\s*<\/[^>]*[^-]>/.test(e);)e=e.replace(/(<[^\/!]>|<[^\/!][^>]*[^\/]>)\s*<\/[^>]*[^-]>/g,"");e=e.replace(/<(\/?)([A-Z0-9]+)/g,function(e,f,n){return"<"+f+n.toLowerCase()});for(var f=/<[^>]+((\s+\w+\s*=\s*)([^"'][\w~@+$,%\/:.#?=&;!*()-]*))[^>]*?>/,n=function(e,f,n,o){var d=f.replace(/([\\\^\$*+[\]?{}.=!:(|)])/g,"\\$1");return e.replace(d,n+'"'+o+'"')};f.test(e);)e=e.replace(f,n);for(;/(<[^>]+style=(["'])[^>]+[\s:]+)0(pt|px)(\2|\s|;)/.test(e);)e=e.replace(/(<[^>]+style=(["'])[^>]+[\s:]+)0(pt|px)(\2|\s|;)/gi,"$10$4");return e=e.replace(/\r\n/g,"\n"),e=e.replace(/^\s+/,"").replace(/\s+$/,"")},clean:function(e){return e=this.removeFormat(e),e=this.tagsoup2html(e)}});n.HtmlCleaner=t},{"./util":9}],7:[function(e,f,n){var o=e("../vendor/rangy/core"),d=e("./util")._;o.api.createCoreModule("RangyExtensions",[],function(e){e.selectionPrototype.getBoundaryNodes=function(){var e,f,n,o;for(this.isBackwards()?(e=this.focusNode,f=this.focusOffset,n=this.anchorNode,o=this.anchorOffset):(e=this.anchorNode,f=this.anchorOffset,n=this.focusNode,o=this.focusOffset),3===e.nodeType&&e.nextSibling&&e.length===f?e=e.nextSibling:1===e.nodeType&&e.childNodes.length>f&&(e=e.childNodes[f]);e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;for(3===n.nodeType&&n.previousSibling&&0===o?n=n.previousSibling:o>0&&1===n.nodeType&&n.childNodes.length>0&&(n=n.childNodes[o-1]);n.lastChild&&1===n.lastChild.nodeType;)n=n.lastChild;return e=e&&1!==e.nodeType?e.parentNode:e,n=n&&1!==n.nodeType?n.parentNode:n,{start:e,end:n}},e.selectionPrototype.getEnclosingNode=function(){var f,n=this.getBoundaryNodes();return f=n.start===n.end?n.start:e.dom.getCommonAncestor(n.start,n.end),e.dom.getDeepestNode(f)},e.selectionPrototype.getTopNodes=function(e,f){e=e||document.body;var n=this.getEnclosingNode(),o=[n];if(n===e)return[];for(;n.parentNode!==e;)n=n.parentNode,o.push(n);return"function"==typeof f?d.filter(o,f):o},e.selectionPrototype.getSurroundingNodes=function(f){var n,o=this.getBoundaryNodes(),i=this.getEnclosingNode(),t=!1,l=[];if(e.dom.isAncestorOf(o.start,o.end,!0))return[o.start];if(e.dom.isAncestorOf(o.end,o.start,!0))return[o.end];for(var u=0;u<i.childNodes.length&&(n=i.childNodes[u],t||(t=e.dom.isAncestorOf(n,o.start,!0)),t&&l.push(n),!e.dom.isAncestorOf(n,o.end,!0));u++);return"function"==typeof f?d.filter(l,f):l},e.dom.hasParents=function(e,f){for(;-1===[document,document.body].indexOf(e)&&null!=e;){
if(-1!==f.indexOf(e))return!0;e=e.parentNode}return!1},e.dom.getDeepestNode=function(e){for(;1===e.childNodes.length&&1===e.firstChild.nodeType;)e=e.firstChild;return e},e.dom.replaceNodeByContents=function(e){var f=this.getDocument(e).createDocumentFragment();d.each(e.childNodes,function(e){f.appendChild(e.cloneNode(!0))}),e.parentNode.replaceChild(f,e)},e.dom.getNodes=function(f,n,o){var d=[];o||"undefined"!=typeof n&&f.nodeType!==n||d.push(f);for(var i=0;i<f.childNodes.length;i++)("undefined"==typeof n||f.childNodes[i].nodeType===n)&&d.push(f.childNodes[i]),[].push.apply(d,e.dom.getNodes(f.childNodes[i],n,!0));return d}})},{"../vendor/rangy/core":11,"./util":9}],8:[function(e,f,n){var o=e("./util"),d=e("./controls"),i=d.ControlsMixin,t=o.extend,l=o.Class,u=l(Object,{defaults:{classPrefix:"",fontAwesomeEnabled:!1},init:function(e,f){i.prototype.init.call(this),this.editor=e,this.options=t({},this.defaults,f||{}),this.element=document.createElement("div"),this.container=document.createElement("ul"),this.dialog=document.createElement("div"),this.container.classList.add(this._getClassName("controls")),this.editor.isRtl&&this.container.classList.add("rtl"),this.element.classList.add(this._getClassName("toolbar")),document.body.appendChild(this.element),this.dialog.classList.add(this._getClassName("dialog")),this.dialog.style.display="none",this.element.appendChild(this.container),this.element.appendChild(this.dialog),this.element.style.visibility="hidden",this._showEvt=document.createEvent("Event"),this._showEvt.initEvent("toolbar.show",!1,!0),this._hideEvt=document.createEvent("Event"),this._hideEvt.initEvent("toolbar.hide",!1,!0),this._dirty=!1},_getClassName:function(e){return this.options.classPrefix+e},click:function(e){this.element.addEventListener("click",e)},focus:function(e){this.element.addEventListener("focus",e)},hide:function(){this.element.style.visibility="hidden",this.element.dispatchEvent(this._hideEvt)},show:function(){this._dirty&&this.drawControls(),this.element.style.visibility="visible",this.element.dispatchEvent(this._showEvt)},showDialog:function(){this.emptyDialog(),this.dialog.style.display="block",this.container.style.display="none"},hideDialog:function(){this.dialog.style.display="none",this.container.style.display="block"},emptyDialog:function(){for(;this.dialog.firstChild;)this.dialog.removeChild(this.dialog.firstChild)},move:function(e,f){this.element.style.top=e+"px",this.element.style.left=f+"px"},addControl:function(e,f,n){this.controls[f]=new e(this,f,n),this._dirty=!0},removeControl:function(e){this.controls[e]&&(i.prototype.removeControl.call(this,e),this._dirty=!0)},drawControls:function(){for(var e;this.container.firstChild;)this.container.removeChild(this.container.firstChild);for(var f in this.controls)e=this.controls[f],this.container.appendChild(e.drawElement());this._dirty=!1}});n.Toolbar=u},{"./controls":1,"./util":9}],9:[function(e,f,n){var o=function(){var e=Array.prototype.slice.call(arguments),f=e.shift(),n="";("string"==typeof f||"boolean"==typeof f)&&(n=f===!0?"deep":f,f=e.shift(),"defaults"===n&&(f=o({},f),n="strict"));for(var d=0,i=e.length;i>d;d++){var t=e[d];for(var l in t)"deep"===n&&"object"==typeof t[l]&&"undefined"!=typeof f[l]?o(n,f[l],t[l]):("strict"!==n||"strict"===n&&"undefined"!=typeof f[l])&&(f[l]=t[l])}return f},d=function(e,f){var n=function(){"undefined"!=typeof this.init&&this.init.apply(this,arguments)},d=function(){};return d.prototype=e.prototype,n.prototype=new d,n.prototype.constructor=e,o(n.prototype,f),n},i=function(e,f){return new i.LazyString(e,f)};i.locale={},i.register=function(e){for(var f in e)i.locale[f]=e[f]},i.LazyString=function(e,f){this.s=e,this.data=f||{}},i.LazyString.prototype.toString=function(){return i.template(i.locale[this.s]||this.s,this.data)},i.template=function(e,f){return e.replace(/\{ *([\w_]+) *\}/g,function(e,n){return f[n]||""})};var t={},l={},u=Array.prototype.forEach,p=Array.prototype.map,s=Array.prototype.filter;t.each=function(e,f,n){if(null==e)return e;if(u&&e.forEach===u)e.forEach(f,n);else if(e.length===+e.length){for(var o=0,d=e.length;d>o;o++)if(f.call(n,e[o],o,e)===l)return}else for(var i=t.keys(e),o=0,d=i.length;d>o;o++)if(f.call(n,e[i[o]],i[o],e)===l)return;return e},t.map=function(e,f,n){var o=[];return null==e?o:p&&e.map===p?e.map(f,n):(t.each(e,function(e,d,i){o.push(f.call(n,e,d,i))}),o)},t.filter=function(e,f,n){var o=[];return null==e?o:s&&e.filter===s?e.filter(f,n):(t.each(e,function(e,d,i){f.call(n,e,d,i)&&o.push(e)}),o)},n.extend=o,n.Class=d,n._=t,n.tr=i},{}],10:[function(e,f,n){n.VERSION="0.3.0",n.rangy=e("./vendor/rangy/core").api,e("./vendor/rangy/dom"),e("./vendor/rangy/domrange"),e("./vendor/rangy/selectionsaverestore"),e("./vendor/rangy/wrappedrange"),e("./vendor/rangy/wrappedselection"),e("./lib/rangy-extensions"),n.extend=e("./lib/util").extend,n.tr=e("./lib/util").tr,n.Class=e("./lib/util").Class,n.HtmlCleaner=e("./lib/html-cleaner").HtmlCleaner,n.Editor=e("./lib/editor").Editor,n.controls=e("./lib/editor").controls,n.simpleEditor=e("./lib/editor").simpleEditor},{"./lib/editor":5,"./lib/html-cleaner":6,"./lib/rangy-extensions":7,"./lib/util":9,"./vendor/rangy/core":11,"./vendor/rangy/dom":12,"./vendor/rangy/domrange":13,"./vendor/rangy/selectionsaverestore":14,"./vendor/rangy/wrappedrange":15,"./vendor/rangy/wrappedselection":16}],11:[function(e,f,n){function o(e,f){var n=typeof e[f];return n==v||!(n!=j||!e[f])||"unknown"==n}function d(e,f){return!(typeof e[f]!=j||!e[f])}function i(e,f){return typeof e[f]!=M}function t(e){return function(f,n){for(var o=n.length;o--;)if(!e(f,n[o]))return!1;return!0}}function l(e){return e&&A(e,z)&&C(e,q)}function u(e){return d(e,"body")?e.body:e.getElementsByTagName("body")[0]}function p(e){d(window,"console")&&o(window.console,"log")&&window.console.log(e)}function s(e,f){f?window.alert(e):p(e)}function y(e){E.initialized=!0,E.supported=!1,s("Rangy is not supported on this page in your browser. Reason: "+e,E.config.alertOnFail)}function a(e){s("Rangy warning: "+e,E.config.alertOnWarn)}function c(e){return e.message||e.description||String(e)}function r(){if(!E.initialized){var e,f=!1,n=!1;o(document,"createRange")&&(e=document.createRange(),A(e,k)&&C(e,h)&&(f=!0),e.detach());var d=u(document);if(!d||"body"!=d.nodeName.toLowerCase())return void y("No body element found");if(d&&o(d,"createTextRange")&&(e=d.createTextRange(),l(e)&&(n=!0)),!f&&!n)return void y("Neither Range nor TextRange are available");E.initialized=!0,E.features={implementsDomRange:f,implementsTextRange:n};var i,t;for(var s in D)(i=D[s])instanceof b&&i.init(i,E);for(var a=0,r=G.length;r>a;++a)try{G[a](E)}catch(w){t="Rangy init listener threw an exception. Continuing. Detail: "+c(w),p(t)}}}function w(e){e=e||window,r();for(var f=0,n=H.length;n>f;++f)H[f](e)}function b(e,f,n){this.name=e,this.dependencies=f,this.initialized=!1,this.supported=!1,this.initializer=n}function m(e,f,n,o){var d=new b(f,n,function(e){if(!e.initialized){e.initialized=!0;try{o(E,e),e.supported=!0}catch(n){var d="Module '"+f+"' failed to load: "+c(n);p(d)}}});D[f]=d}function g(){}function x(){}var j="object",v="function",M="undefined",h=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],k=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],q=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],z=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],A=t(o),B=t(d),C=t(i),D={},E={version:"1.3alpha.804",initialized:!1,supported:!0,util:{isHostMethod:o,isHostObject:d,isHostProperty:i,areHostMethods:A,areHostObjects:B,areHostProperties:C,isTextRange:l,getBody:u},features:{},modules:D,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};E.fail=y,E.warn=a,{}.hasOwnProperty?E.util.extend=function(e,f,n){var o,d;for(var i in f)f.hasOwnProperty(i)&&(o=e[i],d=f[i],n&&null!==o&&"object"==typeof o&&null!==d&&"object"==typeof d&&E.util.extend(o,d,!0),e[i]=d);return e}:y("hasOwnProperty not supported"),function(){var e=document.createElement("div");e.appendChild(document.createElement("span"));var f,n=[].slice;try{1==n.call(e.childNodes,0)[0].nodeType&&(f=function(e){return n.call(e,0)})}catch(o){}f||(f=function(e){for(var f=[],n=0,o=e.length;o>n;++n)f[n]=e[n];return f}),E.util.toArray=f}();var F;o(document,"addEventListener")?F=function(e,f,n){e.addEventListener(f,n,!1)}:o(document,"attachEvent")?F=function(e,f,n){e.attachEvent("on"+f,n)}:y("Document does not have required addEventListener or attachEvent method"),E.util.addListener=F;var G=[];E.init=r,E.addInitListener=function(e){E.initialized?e(E):G.push(e)};var H=[];E.addCreateMissingNativeApiListener=function(e){H.push(e)},E.createMissingNativeApi=w,b.prototype={init:function(e){for(var f,n,o=this.dependencies||[],d=0,i=o.length;i>d;++d){if(n=o[d],f=D[n],!(f&&f instanceof b))throw new Error("required module '"+n+"' not found");if(f.init(),!f.supported)throw new Error("required module '"+n+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){E.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,f){E.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+f+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},E.createModule=function(e){var f,n;2==arguments.length?(f=arguments[1],n=[]):(f=arguments[2],n=arguments[1]),m(!1,e,n,f)},E.createCoreModule=function(e,f,n){m(!0,e,f,n)},E.RangePrototype=g,E.rangePrototype=new g,E.selectionPrototype=new x,n.api=E},{}],12:[function(e,f,n){var o=e("./core");o.api.createCoreModule("DomUtil",[],function(e,f){function n(e){var f;return typeof e.namespaceURI==C||null===(f=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==f}function o(e){var f=e.parentNode;return 1==f.nodeType?f:null}function d(e){for(var f=0;e=e.previousSibling;)++f;return f}function i(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function t(e,f){var n,o=[];for(n=e;n;n=n.parentNode)o.push(n);for(n=f;n;n=n.parentNode)if(G(o,n))return n;return null}function l(e,f,n){for(var o=n?f:f.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1}function u(e,f){return l(e,f,!0)}function p(e,f,n){for(var o,d=n?e:e.parentNode;d;){if(o=d.parentNode,o===f)return d;d=o}return null}function s(e){var f=e.nodeType;return 3==f||4==f||8==f}function y(e){if(!e)return!1;var f=e.nodeType;return 3==f||8==f}function a(e,f){var n=f.nextSibling,o=f.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e}function c(e,f,n){var o=e.cloneNode(!1);if(o.deleteData(0,f),e.deleteData(f,e.length-f),a(o,e),n)for(var i,t=0;i=n[t++];)i.node==e&&i.offset>f?(i.node=o,i.offset-=f):i.node==e.parentNode&&i.offset>d(e)&&++i.offset;return o}function r(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=C)return e.ownerDocument;if(typeof e.document!=C)return e.document;if(e.parentNode)return r(e.parentNode);throw f.createError("getDocument: no document found for node")}function w(e){var n=r(e);if(typeof n.defaultView!=C)return n.defaultView;if(typeof n.parentWindow!=C)return n.parentWindow;throw f.createError("Cannot get a window object for node")}function b(e){if(typeof e.contentDocument!=C)return e.contentDocument;if(typeof e.contentWindow!=C)return e.contentWindow.document;throw f.createError("getIframeDocument: No Document object found for iframe element")}function m(e){if(typeof e.contentWindow!=C)return e.contentWindow;if(typeof e.contentDocument!=C)return e.contentDocument.defaultView;throw f.createError("getIframeWindow: No Window object found for iframe element")}function g(e){return e&&D.isHostMethod(e,"setTimeout")&&D.isHostObject(e,"document")}function x(e,f,n){var o;if(e?D.isHostProperty(e,"nodeType")?o=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?b(e):r(e):g(e)&&(o=e.document):o=document,!o)throw f.createError(n+"(): Parameter must be a Window object or DOM node");return o}function j(e){for(var f;f=e.parentNode;)e=f;return e}function v(e,n,o,i){var l,u,s,y,a;if(e==o)return n===i?0:i>n?-1:1;if(l=p(o,e,!0))return n<=d(l)?-1:1;if(l=p(e,o,!0))return d(l)<i?-1:1;if(u=t(e,o),!u)throw new Error("comparePoints error: nodes have no common ancestor");if(s=e===u?u:p(e,u,!0),y=o===u?u:p(o,u,!0),s===y)throw f.createError("comparePoints got to case 4 and childA and childB are the same!");for(a=u.firstChild;a;){if(a===s)return-1;if(a===y)return 1;a=a.nextSibling}}function M(e){try{return e.parentNode,!1}catch(f){return!0}}function h(e){if(!e)return"[No node]";if(H&&M(e))return"[Broken node]";if(s(e))return'"'+e.data+'"';if(1==e.nodeType){var f=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+f+">["+d(e)+"]["+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function k(e){for(var f,n=r(e).createDocumentFragment();f=e.firstChild;)n.appendChild(f);return n}function q(e){this.root=e,this._next=e}function z(e){return new q(e)}function A(e,f){this.node=e,this.offset=f}function B(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var C="undefined",D=e.util;D.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||f.fail("document missing a Node creation method"),D.isHostMethod(document,"getElementsByTagName")||f.fail("document missing getElementsByTagName method");var E=document.createElement("div");D.areHostMethods(E,["insertBefore","appendChild","cloneNode"]||!D.areHostObjects(E,["previousSibling","nextSibling","childNodes","parentNode"]))||f.fail("Incomplete Element implementation"),D.isHostProperty(E,"innerHTML")||f.fail("Element is missing innerHTML property");var F=document.createTextNode("test");D.areHostMethods(F,["splitText","deleteData","insertData","appendData","cloneNode"]||!D.areHostObjects(E,["previousSibling","nextSibling","childNodes","parentNode"])||!D.areHostProperties(F,["data"]))||f.fail("Incomplete Text Node implementation");var G=function(e,f){for(var n=e.length;n--;)if(e[n]===f)return!0;return!1},H=!1;!function(){var f=document.createElement("b");f.innerHTML="1";var n=f.firstChild;f.innerHTML="<br>",H=M(n),e.features.crashyTextNodes=H}();var I;typeof window.getComputedStyle!=C?I=function(e,f){return w(e).getComputedStyle(e,null)[f]}:typeof document.documentElement.currentStyle!=C?I=function(e,f){return e.currentStyle[f]}:f.fail("No means of obtaining computed style properties found"),q.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,f,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(f=null;n!==this.root&&!(f=n.nextSibling);)n=n.parentNode;this._next=f}return this._current},detach:function(){this._current=this._next=this.root=null}},A.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+h(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},B.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},B.prototype.toString=function(){return this.message},e.dom={arrayContains:G,isHtmlNamespace:n,parentElement:o,getNodeIndex:d,getNodeLength:i,getCommonAncestor:t,isAncestorOf:l,isOrIsAncestorOf:u,getClosestAncestorIn:p,isCharacterDataNode:s,isTextOrCommentNode:y,insertAfter:a,splitDataNode:c,getDocument:r,getWindow:w,getIframeWindow:m,getIframeDocument:b,getBody:D.getBody,isWindow:g,getContentDocument:x,getRootContainer:j,comparePoints:v,isBrokenNode:M,inspectNode:h,getComputedStyleProperty:I,fragmentFromNodeChildren:k,createIterator:z,DomPosition:A},e.DOMException=B})},{"./core":11}],13:[function(e,f,n){var o=e("./core");o.api.createCoreModule("DomRange",["DomUtil"],function(e,f){function n(e,f){return 3!=e.nodeType&&(R(e,f.startContainer)||R(e,f.endContainer))}function o(e){return e.document||S(e.startContainer)}function d(e){return new N(e.parentNode,Q(e))}function i(e){return new N(e.parentNode,Q(e)+1)}function t(e,f,n){var o=11==e.nodeType?e.firstChild:e;return P(f)?n==f.length?K.insertAfter(e,f):f.parentNode.insertBefore(e,0==n?f:U(f,n)):n>=f.childNodes.length?f.appendChild(e):f.insertBefore(e,f.childNodes[n]),o}function l(e,f,n){if(A(e),A(f),o(f)!=o(e))throw new O("WRONG_DOCUMENT_ERR");var d=T(e.startContainer,e.startOffset,f.endContainer,f.endOffset),i=T(e.endContainer,e.endOffset,f.startContainer,f.startOffset);return n?0>=d&&i>=0:0>d&&i>0}function u(e){for(var f,n,d,i=o(e.range).createDocumentFragment();n=e.next();){if(f=e.isPartiallySelectedSubtree(),n=n.cloneNode(!f),f&&(d=e.getSubtreeIterator(),n.appendChild(u(d)),d.detach(!0)),10==n.nodeType)throw new O("HIERARCHY_REQUEST_ERR");i.appendChild(n)}return i}function p(e,f,n){var o,d;n=n||{stop:!1};for(var i,t;i=e.next();)if(e.isPartiallySelectedSubtree()){if(f(i)===!1)return void(n.stop=!0);if(t=e.getSubtreeIterator(),p(t,f,n),t.detach(!0),n.stop)return}else for(o=K.createIterator(i);d=o.next();)if(f(d)===!1)return void(n.stop=!0)}function s(e){for(var f;e.next();)e.isPartiallySelectedSubtree()?(f=e.getSubtreeIterator(),s(f),f.detach(!0)):e.remove()}function y(e){for(var f,n,d=o(e.range).createDocumentFragment();f=e.next();){if(e.isPartiallySelectedSubtree()?(f=f.cloneNode(!1),n=e.getSubtreeIterator(),f.appendChild(y(n)),n.detach(!0)):e.remove(),10==f.nodeType)throw new O("HIERARCHY_REQUEST_ERR");d.appendChild(f)}return d}function a(e,f,n){var o,d=!(!f||!f.length),i=!!n;d&&(o=new RegExp("^("+f.join("|")+")$"));var t=[];return p(new r(e,!1),function(f){if((!d||o.test(f.nodeType))&&(!i||n(f))){var l=e.startContainer;if(f!=l||!P(l)||e.startOffset!=l.length){var u=e.endContainer;f==u&&P(u)&&0==e.endOffset||t.push(f)}}}),t}function c(e){var f="undefined"==typeof e.getName?"Range":e.getName();return"["+f+"("+K.inspectNode(e.startContainer)+":"+e.startOffset+", "+K.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function r(e,f){if(this.range=e,this.clonePartiallySelectedTextNodes=f,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&P(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||P(this.sc)?V(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||P(this.ec)?V(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function w(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function b(e){return function(f,n){for(var o,d=n?f:f.parentNode;d;){if(o=d.nodeType,X(e,o))return d;d=d.parentNode}return null}}function m(e,f){if(ie(e,f))throw new w("INVALID_NODE_TYPE_ERR")}function g(e){if(!e.startContainer)throw new O("INVALID_STATE_ERR")}function x(e,f){if(!X(f,e.nodeType))throw new w("INVALID_NODE_TYPE_ERR")}function j(e,f){if(0>f||f>(P(e)?e.length:e.childNodes.length))throw new O("INDEX_SIZE_ERR")}function v(e,f){if(oe(e,!0)!==oe(f,!0))throw new O("WRONG_DOCUMENT_ERR")}function M(e){if(de(e,!0))throw new O("NO_MODIFICATION_ALLOWED_ERR")}function h(e,f){if(!e)throw new O(f)}function k(e){return Z&&K.isBrokenNode(e)||!X(_,e.nodeType)&&!oe(e,!0)}function q(e,f){return f<=(P(e)?e.length:e.childNodes.length)}function z(e){return!!e.startContainer&&!!e.endContainer&&!k(e.startContainer)&&!k(e.endContainer)&&q(e.startContainer,e.startOffset)&&q(e.endContainer,e.endOffset)}function A(e){if(g(e),!z(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function B(e,f){A(e);var n=e.startContainer,o=e.startOffset,d=e.endContainer,i=e.endOffset,t=n===d;P(d)&&i>0&&i<d.length&&U(d,i,f),P(n)&&o>0&&o<n.length&&(n=U(n,o,f),t?(i-=o,d=n):d==n.parentNode&&i>=Q(n)&&i++,o=0),e.setStartAndEnd(n,o,d,i)}function C(e){e.START_TO_START=ye,e.START_TO_END=ae,e.END_TO_END=ce,e.END_TO_START=re,e.NODE_BEFORE=we,e.NODE_AFTER=be,e.NODE_BEFORE_AND_AFTER=me,e.NODE_INSIDE=ge}function D(e){C(e),C(e.prototype)}function E(e,f){return function(){A(this);var n,o,d=this.startContainer,t=this.startOffset,l=this.commonAncestorContainer,u=new r(this,!0);d!==l&&(n=V(d,l,!0),o=i(n),d=o.node,t=o.offset),p(u,M),u.reset();var s=e(u);return u.detach(),f(this,d,t,d,t),s}}function F(f,o,t){function l(e,f){return function(n){g(this),x(n,$),x(Y(n),_);var o=(e?d:i)(n);(f?u:p)(this,o.node,o.offset)}}function u(e,f,n){var d=e.endContainer,i=e.endOffset;(f!==e.startContainer||n!==e.startOffset)&&((Y(f)!=Y(d)||1==T(f,n,d,i))&&(d=f,i=n),o(e,f,n,d,i))}function p(e,f,n){var d=e.startContainer,i=e.startOffset;(f!==e.endContainer||n!==e.endOffset)&&((Y(f)!=Y(d)||-1==T(f,n,d,i))&&(d=f,i=n),o(e,d,i,f,n))}var a=function(){};a.prototype=e.rangePrototype,f.prototype=new a,L.extend(f.prototype,{setStart:function(e,f){g(this),m(e,!0),j(e,f),u(this,e,f)},setEnd:function(e,f){g(this),m(e,!0),j(e,f),p(this,e,f)},setStartAndEnd:function(){g(this);var e=arguments,f=e[0],n=e[1],d=f,i=n;switch(e.length){case 3:i=e[2];break;case 4:d=e[2],i=e[3]}o(this,f,n,d,i)},setBoundary:function(e,f,n){this["set"+(n?"Start":"End")](e,f)},setStartBefore:l(!0,!0),setStartAfter:l(!1,!0),setEndBefore:l(!0,!1),setEndAfter:l(!1,!1),collapse:function(e){A(this),e?o(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):o(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){g(this),m(e,!0),o(this,e,0,e,W(e))},selectNode:function(e){g(this),m(e,!1),x(e,$);var f=d(e),n=i(e);o(this,f.node,f.offset,n.node,n.offset)},extractContents:E(y,o),deleteContents:E(s,o),canSurroundContents:function(){A(this),M(this.startContainer),M(this.endContainer);var e=new r(this,!0),f=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!f},detach:function(){t(this)},splitBoundaries:function(){B(this)},splitBoundariesPreservingPositions:function(e){B(this,e)},normalizeBoundaries:function(){A(this);var e=this.startContainer,f=this.startOffset,n=this.endContainer,d=this.endOffset,i=function(e){var f=e.nextSibling;f&&f.nodeType==e.nodeType&&(n=e,d=e.length,e.appendData(f.data),f.parentNode.removeChild(f))},t=function(o){var i=o.previousSibling;if(i&&i.nodeType==o.nodeType){e=o;var t=o.length;if(f=i.length,o.insertData(0,i.data),i.parentNode.removeChild(i),e==n)d+=f,n=e;else if(n==o.parentNode){var l=Q(o);d==l?(n=o,d=t):d>l&&d--}}},l=!0;if(P(n))n.length==d&&i(n);else{if(d>0){var u=n.childNodes[d-1];u&&P(u)&&i(u)}l=!this.collapsed}if(l){if(P(e))0==f&&t(e);else if(f<e.childNodes.length){var p=e.childNodes[f];p&&P(p)&&t(p)}}else e=n,f=d;o(this,e,f,n,d)},collapseToPoint:function(e,f){g(this),m(e,!0),j(e,f),this.setStartAndEnd(e,f)}}),D(f)}function G(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:K.getCommonAncestor(e.startContainer,e.endContainer)}function H(e,f,n,o,d){e.startContainer=f,e.startOffset=n,e.endContainer=o,e.endOffset=d,e.document=K.getDocument(f),G(e)}function I(e){g(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=e.document=null,e.collapsed=e.commonAncestorContainer=null}function J(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,G(this)}var K=e.dom,L=e.util,N=K.DomPosition,O=e.DOMException,P=K.isCharacterDataNode,Q=K.getNodeIndex,R=K.isOrIsAncestorOf,S=K.getDocument,T=K.comparePoints,U=K.splitDataNode,V=K.getClosestAncestorIn,W=K.getNodeLength,X=K.arrayContains,Y=K.getRootContainer,Z=e.features.crashyTextNodes;r.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,P(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,f,n=this._current;!P(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,f=n===this.ec?this.eo:n.length,e!=f&&n.deleteData(e,f-e))},isPartiallySelectedSubtree:function(){var e=this._current;return n(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new J(o(this.range));var f=this._current,n=f,d=0,i=f,t=W(f);R(f,this.sc)&&(n=this.sc,d=this.so),R(f,this.ec)&&(i=this.ec,t=this.eo),H(e,n,d,i,t)}return new r(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},w.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},w.prototype.toString=function(){return this.message};var $=[1,3,4,5,7,8,10],_=[2,9,11],ee=[5,6,10,12],fe=[1,3,4,5,7,8,10,11],ne=[1,3,4,5,7,8],oe=b([9,11]),de=b(ee),ie=b([6,10,12]),te=document.createElement("style"),le=!1;try{te.innerHTML="<b>x</b>",le=3==te.firstChild.nodeType}catch(ue){}e.features.htmlParsingConforms=le;var pe=le?function(e){var f=this.startContainer,n=S(f);if(!f)throw new O("INVALID_STATE_ERR");var o=null;return 1==f.nodeType?o=f:P(f)&&(o=K.parentElement(f)),o=null===o||"HTML"==o.nodeName&&K.isHtmlNamespace(S(o).documentElement)&&K.isHtmlNamespace(o)?n.createElement("body"):o.cloneNode(!1),o.innerHTML=e,K.fragmentFromNodeChildren(o)}:function(e){g(this);var f=o(this),n=f.createElement("body");return n.innerHTML=e,K.fragmentFromNodeChildren(n)},se=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ye=0,ae=1,ce=2,re=3,we=0,be=1,me=2,ge=3;L.extend(e.rangePrototype,{compareBoundaryPoints:function(e,f){A(this),v(this.startContainer,f.startContainer);var n,o,d,i,t=e==re||e==ye?"start":"end",l=e==ae||e==ye?"start":"end";return n=this[t+"Container"],o=this[t+"Offset"],d=f[l+"Container"],i=f[l+"Offset"],T(n,o,d,i)},insertNode:function(e){if(A(this),x(e,fe),M(this.startContainer),R(e,this.startContainer))throw new O("HIERARCHY_REQUEST_ERR");var f=t(e,this.startContainer,this.startOffset);this.setStartBefore(f)},cloneContents:function(){A(this);var e,f;if(this.collapsed)return o(this).createDocumentFragment();if(this.startContainer===this.endContainer&&P(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),f=o(this).createDocumentFragment(),f.appendChild(e),f;var n=new r(this,!0);return e=u(n),n.detach(),e},canSurroundContents:function(){A(this),M(this.startContainer),M(this.endContainer);var e=new r(this,!0),f=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!f},surroundContents:function(e){if(x(e,ne),!this.canSurroundContents())throw new w("BAD_BOUNDARYPOINTS_ERR");var f=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);t(e,this.startContainer,this.startOffset),e.appendChild(f),this.selectNode(e)},cloneRange:function(){A(this);for(var e,f=new J(o(this)),n=se.length;n--;)e=se[n],f[e]=this[e];return f},toString:function(){A(this);var e=this.startContainer;if(e===this.endContainer&&P(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var f=[],n=new r(this,!0);return p(n,function(e){(3==e.nodeType||4==e.nodeType)&&f.push(e.data)}),n.detach(),f.join("")},compareNode:function(e){A(this);var f=e.parentNode,n=Q(e);if(!f)throw new O("NOT_FOUND_ERR");var o=this.comparePoint(f,n),d=this.comparePoint(f,n+1);return 0>o?d>0?me:we:d>0?be:ge},comparePoint:function(e,f){return A(this),h(e,"HIERARCHY_REQUEST_ERR"),v(e,this.startContainer),T(e,f,this.startContainer,this.startOffset)<0?-1:T(e,f,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:pe,toHtml:function(){A(this);var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,f){if(A(this),h(e,"NOT_FOUND_ERR"),S(e)!==o(this))return!1;var n=e.parentNode,d=Q(e);h(n,"NOT_FOUND_ERR");var i=T(n,d,this.endContainer,this.endOffset),t=T(n,d+1,this.startContainer,this.startOffset);return f?0>=i&&t>=0:0>i&&t>0},isPointInRange:function(e,f){return A(this),h(e,"HIERARCHY_REQUEST_ERR"),v(e,this.startContainer),T(e,f,this.startContainer,this.startOffset)>=0&&T(e,f,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return l(this,e,!1)},intersectsOrTouchesRange:function(e){return l(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var f=T(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=T(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange();return-1==f&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var f=this.cloneRange();return-1==T(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&f.setStart(e.startContainer,e.startOffset),1==T(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&f.setEnd(e.endContainer,e.endOffset),f}throw new w("Ranges do not intersect")},containsNode:function(e,f){return f?this.intersectsNode(e,!1):this.compareNode(e)==ge},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,W(e))<=0},containsRange:function(e){var f=this.intersection(e);return null!==f&&e.equals(f)},containsNodeText:function(e){var f=this.cloneRange();f.selectNode(e);var n=f.getNodes([3]);if(n.length>0){f.setStart(n[0],0);var o=n.pop();f.setEnd(o,o.length);var d=this.containsRange(f);return f.detach(),d}return this.containsNodeContents(e)},getNodes:function(e,f){return A(this),a(this,e,f)},getDocument:function(){return o(this)},collapseBefore:function(e){g(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){g(this),this.setStartAfter(e),this.collapse(!0)},getBookmark:function(f){var n=o(this),d=e.createRange(n);f=f||K.getBody(n),d.selectNodeContents(f);var i=this.intersection(d),t=0,l=0;return i&&(d.setEnd(i.startContainer,i.startOffset),t=d.toString().length,l=t+i.toString().length,d.detach()),{start:t,end:l,containerNode:f}},moveToBookmark:function(e){var f=e.containerNode,n=0;this.setStart(f,0),this.collapse(!0);for(var o,d,i,t,l=[f],u=!1,p=!1;!p&&(o=l.pop());)if(3==o.nodeType)d=n+o.length,!u&&e.start>=n&&e.start<=d&&(this.setStart(o,e.start-n),u=!0),u&&e.end>=n&&e.end<=d&&(this.setEnd(o,e.end-n),p=!0),n=d;else for(t=o.childNodes,i=t.length;i--;)l.push(t[i])},getName:function(){return"DomRange"},equals:function(e){return J.rangesEqual(this,e)},isValid:function(){return z(this)},inspect:function(){return c(this)}}),F(J,H,I),L.extend(J,{rangeProperties:se,RangeIterator:r,copyComparisonConstants:D,createPrototypeRange:F,inspect:c,getRangeDocument:o,rangesEqual:function(e,f){return e.startContainer===f.startContainer&&e.startOffset===f.startOffset&&e.endContainer===f.endContainer&&e.endOffset===f.endOffset}}),e.DomRange=J,e.RangeException=w})},{"./core":11}],14:[function(e,f,n){var o=e("./core");o.api.createModule("SaveRestore",["WrappedRange"],function(e,f){function n(e,f){return(f||document).getElementById(e)}function o(e,f){var n,o="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),d=r.getDocument(e.startContainer),i=e.cloneRange();return i.collapse(f),n=d.createElement("span"),n.id=o,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(d.createTextNode(w)),i.insertNode(n),i.detach(),n}function d(e,o,d,i){var t=n(d,e);t?(o[i?"setStartBefore":"setEndBefore"](t),
t.parentNode.removeChild(t)):f.warn("Marker element has been removed. Cannot restore selection.")}function i(e,f){return f.compareBoundaryPoints(e.START_TO_START,e)}function t(f,n){var d,i,t=e.DomRange.getRangeDocument(f),l=f.toString();return f.collapsed?(i=o(f,!1),{document:t,markerId:i.id,collapsed:!0}):(i=o(f,!1),d=o(f,!0),{document:t,startMarkerId:d.id,endMarkerId:i.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+l+"', new text: '"+f.toString()+"'"}})}function l(o,i){var t=o.document;"undefined"==typeof i&&(i=!0);var l=e.createRange(t);if(o.collapsed){var u=n(o.markerId,t);if(u){u.style.display="inline";var p=u.previousSibling;p&&3==p.nodeType?(u.parentNode.removeChild(u),l.collapseToPoint(p,p.length)):(l.collapseBefore(u),u.parentNode.removeChild(u))}else f.warn("Marker element has been removed. Cannot restore selection.")}else d(t,l,o.startMarkerId,!0),d(t,l,o.endMarkerId,!1);return i&&l.normalizeBoundaries(),l}function u(f,o){var d,l,u=[];f=f.slice(0),f.sort(i);for(var p=0,s=f.length;s>p;++p)u[p]=t(f[p],o);for(p=s-1;p>=0;--p)d=f[p],l=e.DomRange.getRangeDocument(d),d.collapsed?d.collapseAfter(n(u[p].markerId,l)):(d.setEndBefore(n(u[p].endMarkerId,l)),d.setStartAfter(n(u[p].startMarkerId,l)));return u}function p(n){if(!e.isSelectionValid(n))return f.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var o=e.getSelection(n),d=o.getAllRanges(),i=1==d.length&&o.isBackward(),t=u(d,i);return i?o.setSingleRange(d[0],"backward"):o.setRanges(d),{win:n,rangeInfos:t,restored:!1}}function s(e){for(var f=[],n=e.length,o=n-1;o>=0;o--)f[o]=l(e[o],!0);return f}function y(f,n){if(!f.restored){var o=f.rangeInfos,d=e.getSelection(f.win),i=s(o),t=o.length;1==t&&n&&e.features.selectionHasExtend&&o[0].backward?(d.removeAllRanges(),d.addRange(i[0],!0)):d.setRanges(i),f.restored=!0}}function a(e,f){var o=n(f,e);o&&o.parentNode.removeChild(o)}function c(e){for(var f,n=e.rangeInfos,o=0,d=n.length;d>o;++o)f=n[o],f.collapsed?a(e.doc,f.markerId):(a(e.doc,f.startMarkerId),a(e.doc,f.endMarkerId))}var r=e.dom,w="\ufeff";e.util.extend(e,{saveRange:t,restoreRange:l,saveRanges:u,restoreRanges:s,saveSelection:p,restoreSelection:y,removeMarkerElement:a,removeMarkers:c})})},{"./core":11}],15:[function(e,f,n){var o=e("./core");o.api.createCoreModule("WrappedRange",["DomRange"],function(e,f){var n,o,d=e.dom,i=e.util,t=d.DomPosition,l=e.DomRange,u=d.getBody,p=d.getContentDocument,s=d.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function o(e){for(var f,n=c.length;n--;)f=c[n],e[f]=e.nativeRange[f];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function t(e,f,n,o,d){var i=e.startContainer!==f||e.startOffset!=n,t=e.endContainer!==o||e.endOffset!=d,l=!e.equals(e.nativeRange);(i||t||l)&&(e.setEnd(o,d),e.setStart(f,n))}function s(e){e.nativeRange.detach(),e.detached=!0;for(var f=c.length;f--;)e[c[f]]=null}var y,a,c=l.rangeProperties;n=function(e){if(!e)throw f.createError("WrappedRange: Range must be specified");this.nativeRange=e,o(this)},l.createPrototypeRange(n,t,s),y=n.prototype,y.selectNode=function(e){this.nativeRange.selectNode(e),o(this)},y.cloneContents=function(){return this.nativeRange.cloneContents()},y.surroundContents=function(e){this.nativeRange.surroundContents(e),o(this)},y.collapse=function(e){this.nativeRange.collapse(e),o(this)},y.cloneRange=function(){return new n(this.nativeRange.cloneRange())},y.refresh=function(){o(this)},y.toString=function(){return this.nativeRange.toString()};var r=document.createTextNode("test");u(document).appendChild(r);var w=document.createRange();w.setStart(r,0),w.setEnd(r,0);try{w.setStart(r,1),y.setStart=function(e,f){this.nativeRange.setStart(e,f),o(this)},y.setEnd=function(e,f){this.nativeRange.setEnd(e,f),o(this)},a=function(e){return function(f){this.nativeRange[e](f),o(this)}}}catch(b){y.setStart=function(e,f){try{this.nativeRange.setStart(e,f)}catch(n){this.nativeRange.setEnd(e,f),this.nativeRange.setStart(e,f)}o(this)},y.setEnd=function(e,f){try{this.nativeRange.setEnd(e,f)}catch(n){this.nativeRange.setStart(e,f),this.nativeRange.setEnd(e,f)}o(this)},a=function(e,f){return function(n){try{this.nativeRange[e](n)}catch(d){this.nativeRange[f](n),this.nativeRange[e](n)}o(this)}}}y.setStartBefore=a("setStartBefore","setEndBefore"),y.setStartAfter=a("setStartAfter","setEndAfter"),y.setEndBefore=a("setEndBefore","setStartBefore"),y.setEndAfter=a("setEndAfter","setStartAfter"),y.selectNodeContents=function(e){this.setStartAndEnd(e,0,d.getNodeLength(e))},w.selectNodeContents(r),w.setEnd(r,3);var m=document.createRange();m.selectNodeContents(r),m.setEnd(r,4),m.setStart(r,2),-1==w.compareBoundaryPoints(w.START_TO_END,m)&&1==w.compareBoundaryPoints(w.END_TO_START,m)?y.compareBoundaryPoints=function(e,f){return f=f.nativeRange||f,e==f.START_TO_END?e=f.END_TO_START:e==f.END_TO_START&&(e=f.START_TO_END),this.nativeRange.compareBoundaryPoints(e,f)}:y.compareBoundaryPoints=function(e,f){return this.nativeRange.compareBoundaryPoints(e,f.nativeRange||f)};var g=document.createElement("div");g.innerHTML="123";var x=g.firstChild,j=u(document);j.appendChild(g),w.setStart(x,1),w.setEnd(x,2),w.deleteContents(),"13"==x.data&&(y.deleteContents=function(){this.nativeRange.deleteContents(),o(this)},y.extractContents=function(){var e=this.nativeRange.extractContents();return o(this),e}),j.removeChild(g),j=null,i.isHostMethod(w,"createContextualFragment")&&(y.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),u(document).removeChild(r),w.detach(),m.detach(),y.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=p(e,f,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var y=function(e){var f=e.parentElement(),n=e.duplicate();n.collapse(!0);var o=n.parentElement();n=e.duplicate(),n.collapse(!1);var i=n.parentElement(),t=o==i?o:d.getCommonAncestor(o,i);return t==f?t:d.getCommonAncestor(f,t)},a=function(e){return 0==e.compareEndPoints("StartToEnd",e)},c=function(e,f,n,o,i){var l=e.duplicate();l.collapse(n);var u=l.parentElement();if(d.isOrIsAncestorOf(f,u)||(u=f),!u.canHaveHTML){var p=new t(u.parentNode,d.getNodeIndex(u));return{boundaryPosition:p,nodeInfo:{nodeIndex:p.offset,containerElement:p.node}}}var y=d.getDocument(u).createElement("span");y.parentNode&&y.parentNode.removeChild(y);for(var a,c,r,w,b,m=n?"StartToStart":"StartToEnd",g=i&&i.containerElement==u?i.nodeIndex:0,x=u.childNodes.length,j=x,v=j;;){if(v==x?u.appendChild(y):u.insertBefore(y,u.childNodes[v]),l.moveToElementText(y),a=l.compareEndPoints(m,e),0==a||g==j)break;if(-1==a){if(j==g+1)break;g=v}else j=j==g+1?g:v;v=Math.floor((g+j)/2),u.removeChild(y)}if(b=y.nextSibling,-1==a&&b&&s(b)){l.setEndPoint(n?"EndToStart":"EndToEnd",e);var M;if(/[\r\n]/.test(b.data)){var h=l.duplicate(),k=h.text.replace(/\r\n/g,"\r").length;for(M=h.moveStart("character",k);-1==(a=h.compareEndPoints("StartToEnd",h));)M++,h.moveStart("character",1)}else M=l.text.length;w=new t(b,M)}else c=(o||!n)&&y.previousSibling,r=(o||n)&&y.nextSibling,w=r&&s(r)?new t(r,0):c&&s(c)?new t(c,c.data.length):new t(u,d.getNodeIndex(y));return y.parentNode.removeChild(y),{boundaryPosition:w,nodeInfo:{nodeIndex:v,containerElement:u}}},r=function(e,f){var n,o,i,t,l=e.offset,p=d.getDocument(e.node),y=u(p).createTextRange(),a=s(e.node);return a?(n=e.node,o=n.parentNode):(t=e.node.childNodes,n=l<t.length?t[l]:null,o=e.node),i=p.createElement("span"),i.innerHTML="&#feff;",n?o.insertBefore(i,n):o.appendChild(i),y.moveToElementText(i),y.collapse(!f),o.removeChild(i),a&&y[f?"moveStart":"moveEnd"]("character",l),y};if(o=function(e){this.textRange=e,this.refresh()},o.prototype=new l(document),o.prototype.refresh=function(){var e,f,n,o=y(this.textRange);a(this.textRange)?f=e=c(this.textRange,o,!0,!0).boundaryPosition:(n=c(this.textRange,o,!0,!1),e=n.boundaryPosition,f=c(this.textRange,o,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(f.node,f.offset)},o.prototype.getName=function(){return"WrappedTextRange"},l.copyComparisonConstants(o),o.rangeToTextRange=function(e){if(e.collapsed)return r(new t(e.startContainer,e.startOffset),!0);var f=r(new t(e.startContainer,e.startOffset),!0),n=r(new t(e.endContainer,e.endOffset),!1),o=u(l.getRangeDocument(e)).createTextRange();return o.setEndPoint("StartToStart",f),o.setEndPoint("EndToEnd",n),o},e.WrappedTextRange=o,!e.features.implementsDomRange||e.config.preferTextRange){var w=function(){return this}();"undefined"==typeof w.Range&&(w.Range=o),e.createNativeRange=function(e){return e=p(e,f,"createNativeRange"),u(e).createTextRange()},e.WrappedRange=o}}e.createRange=function(n){return n=p(n,f,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=p(e,f,"createRangyRange"),new l(e)},e.createIframeRange=function(n){return f.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return f.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addCreateMissingNativeApiListener(function(f){var n=f.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=f=null})})},{"./core":11}],16:[function(e,f,n){var o=e("./core");o.api.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,f){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function o(e,n){if(e){if(B.isWindow(e))return e;if(e instanceof m)return e.win;var o=B.getContentDocument(e,f,n);return B.getWindow(o)}return window}function d(e){return o(e,"getWinSelection").getSelection()}function i(e){return o(e,"getDocSelection").document.selection}function t(e){var f=!1;return e.anchorNode&&(f=1==B.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),f}function l(e,f,n){var o=n?"end":"start",d=n?"start":"end";e.anchorNode=f[o+"Container"],e.anchorOffset=f[o+"Offset"],e.focusNode=f[d+"Container"],e.focusOffset=f[d+"Offset"]}function u(e){var f=e.nativeSelection;e.anchorNode=f.anchorNode,e.anchorOffset=f.anchorOffset,e.focusNode=f.focusNode,e.focusOffset=f.focusOffset}function p(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function s(f){var n;return f instanceof E?(n=e.createNativeRange(f.getDocument()),n.setEnd(f.endContainer,f.endOffset),n.setStart(f.startContainer,f.startOffset)):f instanceof F?n=f.nativeRange:I.implementsDomRange&&f instanceof B.getWindow(f.startContainer).Range&&(n=f),n}function y(e){if(!e.length||1!=e[0].nodeType)return!1;for(var f=1,n=e.length;n>f;++f)if(!B.isAncestorOf(e[0],e[f]))return!1;return!0}function a(e){var n=e.getNodes();if(!y(n))throw f.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function c(e){return!!e&&"undefined"!=typeof e.text}function r(e,f){var n=new F(f);e._ranges=[n],l(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function w(f){if(f._ranges.length=0,"None"==f.docSelection.type)p(f);else{var n=f.docSelection.createRange();if(c(n))r(f,n);else{f.rangeCount=n.length;for(var o,d=K(n.item(0)),i=0;i<f.rangeCount;++i)o=e.createRange(d),o.selectNode(n.item(i)),f._ranges.push(o);f.isCollapsed=1==f.rangeCount&&f._ranges[0].collapsed,l(f,f._ranges[f.rangeCount-1],!1)}}}function b(e,n){for(var o=e.docSelection.createRange(),d=a(n),i=K(o.item(0)),t=L(i).createControlRange(),l=0,u=o.length;u>l;++l)t.add(o.item(l));try{t.add(d)}catch(p){throw f.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}t.select(),w(e)}function m(e,f,n){this.nativeSelection=e,this.docSelection=f,this._ranges=[],this.win=n,this.refresh()}function g(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function x(e,f){for(var n,o,d=fe.length;d--;)if(n=fe[d],o=n.selection,"deleteAll"==f)g(o);else if(n.win==e)return"delete"==f?(fe.splice(d,1),!0):o;return"deleteAll"==f&&(fe.length=0),null}function j(e,n){for(var o,d=K(n[0].startContainer),i=L(d).createControlRange(),t=0,l=n.length;l>t;++t){o=a(n[t]);try{i.add(o)}catch(u){throw f.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),w(e)}function v(e,f){if(e.win.document!=K(f))throw new G("WRONG_DOCUMENT_ERR")}function M(f){return function(n,o){var d;this.rangeCount?(d=this.getRangeAt(0),d["set"+(f?"Start":"End")](n,o)):(d=e.createRange(this.win.document),d.setStartAndEnd(n,o)),this.setSingleRange(d,this.isBackward())}}function h(e){var f=[],n=new H(e.anchorNode,e.anchorOffset),o=new H(e.focusNode,e.focusOffset),d="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var i=0,t=e.rangeCount;t>i;++i)f[i]=E.inspect(e.getRangeAt(i));return"["+d+"(Ranges: "+f.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}e.config.checkSelectionRanges=!0;var k,q,z="boolean",A="number",B=e.dom,C=e.util,D=C.isHostMethod,E=e.DomRange,F=e.WrappedRange,G=e.DOMException,H=B.DomPosition,I=e.features,J="Control",K=B.getDocument,L=B.getBody,N=E.rangesEqual,O=D(window,"getSelection"),P=C.isHostObject(document,"selection");I.implementsWinGetSelection=O,I.implementsDocSelection=P;var Q=P&&(!O||e.config.preferTextRange);Q?(k=i,e.isSelectionValid=function(e){var f=o(e,"isSelectionValid").document,n=f.selection;return"None"!=n.type||K(n.createRange().parentElement())==f}):O?(k=d,e.isSelectionValid=function(){return!0}):f.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=k;var R=k(),S=e.createNativeRange(document),T=L(document),U=C.areHostProperties(R,["anchorNode","focusNode","anchorOffset","focusOffset"]);I.selectionHasAnchorAndFocus=U;var V=D(R,"extend");I.selectionHasExtend=V;var W=typeof R.rangeCount==A;I.selectionHasRangeCount=W;var X=!1,Y=!0,Z=V?function(f,n){var o=E.getRangeDocument(n),d=e.createRange(o);d.collapseToPoint(n.endContainer,n.endOffset),f.addRange(s(d)),f.extend(n.startContainer,n.startOffset)}:null;C.areHostMethods(R,["addRange","getRangeAt","removeAllRanges"])&&typeof R.rangeCount==A&&I.implementsDomRange&&!function(){var f=window.getSelection();if(f){for(var n=f.rangeCount,o=n>1,d=[],i=t(f),l=0;n>l;++l)d[l]=f.getRangeAt(l);var u=L(document),p=u.appendChild(document.createElement("div"));p.contentEditable="false";var s=p.appendChild(document.createTextNode("   ")),y=document.createRange();if(y.setStart(s,1),y.collapse(!0),f.addRange(y),Y=1==f.rangeCount,f.removeAllRanges(),!o){var a=y.cloneRange();y.setStart(s,0),a.setEnd(s,3),a.setStart(s,2),f.addRange(y),f.addRange(a),X=2==f.rangeCount,a.detach()}for(u.removeChild(p),f.removeAllRanges(),y.detach(),l=0;n>l;++l)0==l&&i?Z?Z(f,d[l]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend"),f.addRange(d[l])):f.addRange(d[l])}}(),I.selectionSupportsMultipleRanges=X,I.collapsedNonEditableSelectionsSupported=Y;var $,_=!1;T&&D(T,"createControlRange")&&($=T.createControlRange(),C.areHostProperties($,["item","add"])&&(_=!0)),I.implementsControlRange=_,q=U?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var ee;D(R,"getRangeAt")?ee=function(e,f){try{return e.getRangeAt(f)}catch(n){return null}}:U&&(ee=function(f){var n=K(f.anchorNode),o=e.createRange(n);return o.setStartAndEnd(f.anchorNode,f.anchorOffset,f.focusNode,f.focusOffset),o.collapsed!==this.isCollapsed&&o.setStartAndEnd(f.focusNode,f.focusOffset,f.anchorNode,f.anchorOffset),o}),m.prototype=e.selectionPrototype;var fe=[],ne=function(e){if(e&&e instanceof m)return e.refresh(),e;e=o(e,"getNativeSelection");var f=x(e),n=k(e),d=P?i(e):null;return f?(f.nativeSelection=n,f.docSelection=d,f.refresh()):(f=new m(n,d,e),fe.push({win:e,selection:f})),f};e.getSelection=ne,e.getIframeSelection=function(n){return f.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(B.getIframeWindow(n))};var oe=m.prototype;if(!Q&&U&&C.areHostMethods(R,["removeAllRanges","addRange"])){oe.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),p(this)};var de=function(e,f){Z(e.nativeSelection,f),e.refresh()};W?oe.addRange=function(f,o){if(_&&P&&this.docSelection.type==J)b(this,f);else if(n(o)&&V)de(this,f);else{var d;if(X?d=this.rangeCount:(this.removeAllRanges(),d=0),this.nativeSelection.addRange(s(f).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==d+1){if(e.config.checkSelectionRanges){var i=ee(this.nativeSelection,this.rangeCount-1);i&&!N(i,f)&&(f=new F(i))}this._ranges[this.rangeCount-1]=f,l(this,f,le(this.nativeSelection)),this.isCollapsed=q(this)}else this.refresh()}}:oe.addRange=function(e,f){n(f)&&V?de(this,e):(this.nativeSelection.addRange(s(e)),this.refresh())},oe.setRanges=function(e){if(_&&e.length>1)j(this,e);else{this.removeAllRanges();for(var f=0,n=e.length;n>f;++f)this.addRange(e[f])}}}else{if(!(D(R,"empty")&&D(S,"select")&&_&&Q))return f.fail("No means of selecting a Range or TextRange was found"),!1;oe.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=K(this.anchorNode);else if(this.docSelection.type==J){var f=this.docSelection.createRange();f.length&&(e=K(f.item(0)))}if(e){var n=L(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(o){}p(this)},oe.addRange=function(f){this.docSelection.type==J?b(this,f):(e.WrappedTextRange.rangeToTextRange(f).select(),this._ranges[0]=f,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,l(this,f,!1))},oe.setRanges=function(e){this.removeAllRanges();var f=e.length;f>1?j(this,e):f&&this.addRange(e[0])}}oe.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new G("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var ie;if(Q)ie=function(f){var n;e.isSelectionValid(f.win)?n=f.docSelection.createRange():(n=L(f.win.document).createTextRange(),n.collapse(!0)),f.docSelection.type==J?w(f):c(n)?r(f,n):p(f)};else if(D(R,"getRangeAt")&&typeof R.rangeCount==A)ie=function(f){if(_&&P&&f.docSelection.type==J)w(f);else if(f._ranges.length=f.rangeCount=f.nativeSelection.rangeCount,f.rangeCount){for(var n=0,o=f.rangeCount;o>n;++n)f._ranges[n]=new e.WrappedRange(f.nativeSelection.getRangeAt(n));l(f,f._ranges[f.rangeCount-1],le(f.nativeSelection)),f.isCollapsed=q(f)}else p(f)};else{if(!U||typeof R.isCollapsed!=z||typeof S.collapsed!=z||!I.implementsDomRange)return f.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;ie=function(e){var f,n=e.nativeSelection;n.anchorNode?(f=ee(n,0),e._ranges=[f],e.rangeCount=1,u(e),e.isCollapsed=q(e)):p(e)}}oe.refresh=function(e){var f=e?this._ranges.slice(0):null,n=this.anchorNode,o=this.anchorOffset;if(ie(this),e){var d=f.length;if(d!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=o)return!0;for(;d--;)if(!N(f[d],this._ranges[d]))return!0;return!1}};var te=function(e,f){var n=e.getAllRanges();e.removeAllRanges();for(var o=0,d=n.length;d>o;++o)N(f,n[o])||e.addRange(n[o]);e.rangeCount||p(e)};_?oe.removeRange=function(e){if(this.docSelection.type==J){for(var f,n=this.docSelection.createRange(),o=a(e),d=K(n.item(0)),i=L(d).createControlRange(),t=!1,l=0,u=n.length;u>l;++l)f=n.item(l),f!==o||t?i.add(n.item(l)):t=!0;i.select(),w(this)}else te(this,e)}:oe.removeRange=function(e){te(this,e)};var le;!Q&&U&&I.implementsDomRange?(le=t,oe.isBackward=function(){return le(this)}):le=oe.isBackward=function(){return!1},oe.isBackwards=oe.isBackward,oe.toString=function(){for(var e=[],f=0,n=this.rangeCount;n>f;++f)e[f]=""+this._ranges[f];return e.join("")},oe.collapse=function(f,n){v(this,f);var o=e.createRange(f);o.collapseToPoint(f,n),this.setSingleRange(o),this.isCollapsed=!0},oe.collapseToStart=function(){if(!this.rangeCount)throw new G("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},oe.collapseToEnd=function(){if(!this.rangeCount)throw new G("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},oe.selectAllChildren=function(f){v(this,f);var n=e.createRange(f);n.selectNodeContents(f),this.setSingleRange(n)},oe.deleteFromDocument=function(){if(_&&P&&this.docSelection.type==J){for(var e,f=this.docSelection.createRange();f.length;)e=f.item(0),f.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var o=0,d=n.length;d>o;++o)n[o].deleteContents();this.addRange(n[d-1])}}},oe.eachRange=function(e,f){for(var n=0,o=this._ranges.length;o>n;++n)if(e(this.getRangeAt(n)))return f},oe.getAllRanges=function(){var e=[];return this.eachRange(function(f){e.push(f)}),e},oe.setSingleRange=function(e,f){this.removeAllRanges(),this.addRange(e,f)},oe.callMethodOnEachRange=function(e,f){var n=[];return this.eachRange(function(o){n.push(o[e].apply(o,f))}),n},oe.setStart=M(!0),oe.setEnd=M(!1),e.rangePrototype.select=function(e){ne(this.getDocument()).setSingleRange(this,e)},oe.changeEachRange=function(e){var f=[],n=this.isBackward();this.eachRange(function(n){e(n),f.push(n)}),this.removeAllRanges(),n&&1==f.length?this.addRange(f[0],"backward"):this.setRanges(f)},oe.containsNode=function(e,f){return this.eachRange(function(n){return n.containsNode(e,f)},!0)},oe.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},oe.moveToBookmark=function(f){for(var n,o,d=[],i=0;n=f.rangeBookmarks[i++];)o=e.createRange(this.win),o.moveToBookmark(n),d.push(o);f.backward?this.setSingleRange(d[0],"backward"):this.setRanges(d)},oe.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},oe.getName=function(){return"WrappedSelection"},oe.inspect=function(){return h(this)},oe.detach=function(){x(this.win,"delete"),g(this)},m.detachAll=function(){x(null,"deleteAll")},m.inspect=h,m.isDirectionBackward=n,e.Selection=m,e.selectionPrototype=oe,e.addCreateMissingNativeApiListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return ne(e)}),e=null})})},{"./core":11}]},{},[10])(10)});
//# sourceMappingURL=minislate.min.map